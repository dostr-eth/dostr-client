"use strict";(globalThis["webpackChunkDostr"]=globalThis["webpackChunkDostr"]||[]).push([[408],{28128:(t,i,e)=>{e.r(i),e.d(i,{default:()=>_});var o=e(59835),s=e(86970);const a=(0,o._)("div",{class:"bottom-border"},null,-1),n={style:{"margin-top":"45px"}};function r(t,i,e,r,c,h){const d=(0,o.up)("BaseHeader"),l=(0,o.up)("BasePost"),f=(0,o.up)("BaseButtonLoadMore"),u=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(u,{style:{"margin-top":"15px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{style:{"margin-left":"30px"},class:"spotnik"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(t.$t("notifications")),1)])),_:1}),(0,o._)("div",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(c.notifications,(i=>((0,o.wg)(),(0,o.iD)("div",{key:i.id},[(0,o.Wm)(l,{event:i,highlighted:t.$store.state.lastNotificationRead<i.created_at},null,8,["event","highlighted"]),a])))),128)),(0,o._)("div",n,[(0,o.Wm)(f,{"loading-more":c.loadingMore,"reached-end":c.reachedEnd,onClick:h.loadMore},null,8,["loading-more","reached-end","onClick"])])])])),_:1})}var c=e(18933),h=e(26041),d=e(34136),l=e(31020),f=e(68620);const u={title:"Dostr - Notifications",meta:{description:{name:"description",content:"Nostr notifications on Dostr"},keywords:{name:"keywords",content:"nostr dostr decentralized social media siwe siwx"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},g={name:"Notifications",mixins:[c.Z,(0,l.Z)(u)],components:{BaseButtonLoadMore:f.Z},data(){return{notifications:[],notificationsSet:new Set,reachedEnd:!1,unsubscribe:null,reading:!1,loadingMore:!0}},mounted(){this.start()},activated(){this.$store.state.unreadNotifications&&this.loadNew(),this.highlightUnreadNotifications()},deactivated(){this.$store.commit("haveReadNotifications")},beforeUnmount(){this.unsubscribe&&this.unsubscribe()},methods:{async start(){this.loadingMore=!0,this.loadMore(),this.unsubscribe=this.$store.subscribe((({type:t,payload:i},e)=>{switch(t){case"setUnreadNotifications":this.loadNew();break}})),this.highlightUnreadNotifications(),this.loadingMore=!1},async loadMore(){let t;t=this.notifications.length?this.notifications[this.notifications.length-1].created_at-1:Math.round(Date.now()/1e3);let i=await(0,d.t_)(this.$store.state.keys.pub,50,t);await this.processNotifications(i),this.highlightUnreadNotifications(),this.loadingMore=!1},async loadNew(t=40){let i=await(0,d.t_)(this.$store.state.keys.pub,t);await this.processNotifications(i)},processNotifications(t){let i=[];for(let e=0;e<t.length;e++){let i=t[e];this.notificationsSet.has(i.id)||(this.notificationsSet.add(i.id),this.interpolateEventMentions(i),(0,h.aR)(this.notifications,i,((t,i)=>t.created_at<i.created_at)),this.useProfile(i.pubkey))}return i},highlightUnreadNotifications(){this.notifications.length>0&&this.notifications[0].created_at>this.$store.state.lastNotificationRead&&setTimeout((()=>{this.$store.commit("haveReadNotifications")}),3e3*this.notifications.filter((t=>t.created_at>this.$store.state.lastNotificationRead)).length)},addNotificationEvent(t){if(0===this.notifications.length)return void this.notifications.push(t);if(this.notifications[this.notifications.length-1].created_at>=t.created_at)return void this.notifications.push(t);if(this.notifications[0].created_at<=t.created_at)return void this.notifications.unshift(t);let i=this.notifications.findIndex(((i,e,o)=>i.created_at<=t.created_at&&(0===e||o[e-1].created_at>=t.created_at)));i>=0?this.notifications.splice(i,0,t):this.notifications.push(t)},useProfile(t){this.$store.dispatch("useProfile",{pubkey:t})}}};var p=e(11639),m=e(69885),b=e(69984),w=e.n(b);const N=(0,p.Z)(g,[["render",r]]),_=N;w()(g,"components",{QPage:m.Z})}}]);
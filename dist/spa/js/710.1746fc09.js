"use strict";(globalThis["webpackChunkdostr"]=globalThis["webpackChunkdostr"]||[]).push([[710],{18710:(e,t,s)=>{s.r(t),s.d(t,{default:()=>S});var n=s(59835),i=s(86970);const r=e=>((0,n.dD)("data-v-d1770d48"),e=e(),(0,n.Cn)(),e),o={key:0,ref:"ancestors"},l={class:"relative-position"},a={key:0,class:"is-reply-connector"},h={key:1},d={key:2},c={class:"text-h6 text-bold q-px-sm"},v=r((()=>(0,n._)("div",{style:{"min-height":"30vh"}},null,-1)));function u(e,t,s,r,u,p){const y=(0,n.up)("BaseHeader"),g=(0,n.up)("BasePostThread"),b=(0,n.up)("BaseButtonShowMore"),E=(0,n.up)("BasePost"),k=(0,n.up)("BaseRelayList"),m=(0,n.up)("q-item"),w=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(w,{ref:"page",style:{"margin-top":"20px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{class:"spotnik"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(e.$t("thread")),1)])),_:1}),e.ancestorsCompiled.length||e.rootAncestor?((0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(g,{events:e.ancestorsCompiled,"is-ancestors":"",onAddEvent:e.addEventAncestors},null,8,["events","onAddEvent"])],512)):(0,n.kq)("",!0),e.ancestorsMissing?((0,n.wg)(),(0,n.j4)(b,{key:1,root:e.ancestorsMissing},null,8,["root"])):(0,n.kq)("",!0),(0,n._)("div",l,[e.ancestors&&e.ancestors.length?((0,n.wg)(),(0,n.iD)("div",a)):(0,n.kq)("",!0),(0,n.Wm)(m,{ref:"main",class:"column relative-position",style:{border:"2px solid var(--q-accent)","border-radius":"1rem","z-index":"1",background:"var(--q-background)"}},{default:(0,n.w5)((()=>[e.event?((0,n.wg)(),(0,n.j4)(E,{key:0,event:e.event,highlighted:!0,"reply-count":e.childrenThreadsFiltered?.length,position:"standalone",onAddEvent:e.processChildEvent},null,8,["event","reply-count","onAddEvent"])):((0,n.wg)(),(0,n.iD)("div",h,(0,i.zw)(e.$route.params.eventId),1)),e.event?((0,n.wg)(),(0,n.j4)(k,{key:2,event:e.event,class:"q-px-sm"},null,8,["event"])):(0,n.kq)("",!0)])),_:1},512)]),e.childrenThreadsFiltered.length?((0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("div",c,(0,i.zw)(e.$t("replies")),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.childrenThreadsFiltered,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t[0].id},[(0,n.Wm)(g,{events:t,onAddEvent:e.processChildEvent},null,8,["events","onAddEvent"])])))),128))])):(0,n.kq)("",!0),v])),_:1},512)}s(46727);var p=s(34136),y=s(18933),g=s(14473),b=s(97010),E=s(31020),k=s(45938);const m={title:"Dostr - Thread",meta:{description:{name:"description",content:"Nostr event thread"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},w=(0,n.aZ)({name:"Event",emits:["scroll-to-rect"],mixins:[y.Z,(0,E.Z)(m)],components:{BaseRelayList:b.Z,BaseButtonShowMore:k.Z},data(){return{replying:!1,ancestors:[],ancestorsSeen:new Map,ancestorIds:[],rootAncestor:null,event:null,childrenThreads:[],childrenSet:new Set,sub:{},profilesUsed:new Set}},computed:{childrenThreadsFiltered(){return this.childrenThreads.filter((e=>e[0].interpolated.replyEvents.includes(this.hexEventId)))},ancestorsCompiled(){return this.rootAncestor?this.ancestors.length&&this.rootAncestor&&this.ancestors[0].id===this.rootAncestor.id?this.ancestors:[this.rootAncestor].concat(this.ancestors):this.ancestors},hexEventId(){return this.bech32ToHex(this.$route.params.eventId)},ancestorsMissing(){let e=this.ancestorsCompiled;if(!e?.length)return!1;let t=e[e.length-1],s=this.event.interpolated.replyEvents,n=s[s.length-1];return t.id===n?null:t.id}},mounted(){this.hexEventId&&this.start()},beforeUnmount(){this.stop()},methods:{async start(){let e=Object.keys(this.$store.state.relays).length?Object.keys(this.$store.state.relays):Object.keys(this.$store.state.defaultRelays);this.sub.event=await(0,p.w8)({ids:[this.hexEventId],relays:e},(e=>{if(!e?.length)return;let t=e[0],s=!1;this.event||(s=!0),this.interpolateEventMentions(t),this.event=null,this.event=t,s&&(this.event.interpolated.replyEvents.length&&this.subRootAncestor(),this.subAncestorsChildren()),this.useProfile(t.pubkey)}),!0),this.subAncestorsChildren()},stop(){this.replying=!1,this.sub.event&&this.sub.event.cancel(),this.sub.ancestorsChildren&&this.sub.ancestorsChildren.cancel(),this.sub.rootAncestor&&this.sub.rootAncestor.cancel(),this.replying=!1,this.ancestors=[],this.ancestorsSeen=new Map,this.ancestorIds=[],this.rootAncestor=null,this.event=null,this.childrenThreads=[],this.childrenSet=new Set,this.sub={},this.profilesUsed=new Set},async subRootAncestor(){let e=Object.keys(this.$store.state.relays).length?Object.keys(this.$store.state.relays):Object.keys(this.$store.state.defaultRelays);this.sub.rootAncestor=await(0,p.w8)({ids:[this.event.interpolated.replyEvents[0]],relays:e},(e=>{if(!e?.length)return;let t=e[0];this.processAncestorEvent(t),this.sub.rootAncestor.cancel()}))},async subAncestorsChildren(){if(!this.hexEventId)return;let e=Object.keys(this.$store.state.relays).length?Object.keys(this.$store.state.relays):Object.keys(this.$store.state.defaultRelays),t=this.event?.interpolated?.replyEvents?.length?[this.hexEventId,this.event.interpolated.replyEvents[0]]:[this.hexEventId];this.sub.ancestorsChildren?this.sub.ancestorsChildren.update({type:"e",values:t,kinds:[1],relays:e}):this.sub.ancestorsChildren=await(0,p.dq)({type:"e",values:t,kinds:[1],relays:e},(e=>{for(let t of e)this.event&&t.created_at<this.event.created_at?this.processAncestorEvent(t):this.processChildEvent(t)}))},processAncestorEvent(e){let t=this.ancestors.length?this.ancestors[this.ancestors.length-1]:this.event;if(0===t.interpolated.replyEvents.length)return;let s=this.ancestorsSeen.get(e.id);if(s)return;this.interpolateEventMentions(e),this.ancestorsSeen.set(e.id,e),this.event?.interpolated?.replyEvents?.[0]===e.id&&(this.rootAncestor=e);let n=t.interpolated.replyEvents[t.interpolated.replyEvents.length-1];if(n===e.id){let s=e;while(s)this.ancestors=[s].concat(this.ancestors),this.scrollToMainEvent(),this.useProfile(s.pubkey),t=s,n=t.interpolated.replyEvents[t.interpolated.replyEvents.length-1],s=this.ancestorsSeen.get(n)}},processChildEvent(e){e.id!==this.hexEventId&&(this.childrenSet.has(e.id)||(this.childrenSet.add(e.id),this.useProfile(e.pubkey),this.interpolateEventMentions(e),(0,g.c)(this.childrenThreads,e,"",e.pubkey!==this.$store.state.keys.pub)))},scrollToMainEvent(){(0,n.Y3)((()=>{let e=this.$refs.main?.$el.getBoundingClientRect();this.$emit("scroll-to-rect",e)}))},addEventAncestors(e){this.interpolateEventMentions(e),this.toEvent(e.id)},useProfile(e){this.$store.dispatch("useProfile",{pubkey:e})}}});var f=s(11639),A=s(69885),C=s(490),x=s(69984),$=s.n(x);const T=(0,f.Z)(w,[["render",u],["__scopeId","data-v-d1770d48"]]),S=T;$()(w,"components",{QPage:A.Z,QItem:C.Z})}}]);
"use strict";(globalThis["webpackChunkDostr"]=globalThis["webpackChunkDostr"]||[]).push([[20],{93405:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var a=t(59835),l=t(61957),o=t(86970);const n={id:"profile-header"},r={key:1},i={key:2},h={key:0},d={key:1,class:"flex column relative"},u={class:"q-pl-sm"},c={key:0},p={key:1,class:"flex column relative"},b={class:"q-pl-sm"},m={key:0},w={key:1,class:"flex column relative"},y={class:"q-pl-sm sf-mono-tight"};function f(e,s,t,f,g,k){const v=(0,a.up)("BaseUserCard"),x=(0,a.up)("q-tab"),P=(0,a.up)("q-tabs"),E=(0,a.up)("BaseButtonClear"),$=(0,a.up)("q-btn"),T=(0,a.up)("q-input"),_=(0,a.up)("q-form"),q=(0,a.up)("BasePostThread"),D=(0,a.up)("BaseButtonLoadMore"),j=(0,a.up)("q-tab-panel"),S=(0,a.up)("BaseRelayRecommend"),Z=(0,a.up)("q-tab-panels"),U=(0,a.up)("q-page");return(0,a.wg)(),(0,a.j4)(U,null,{default:(0,a.w5)((()=>[(0,a._)("div",n,[e.hexPubkey?((0,a.wg)(),(0,a.j4)(v,{key:0,pubkey:e.hexPubkey,class:"user-card-header q-ma-sm","header-mode":!0,"show-following":!0,clickable:!1},null,8,["pubkey"])):(0,a.kq)("",!0)]),(0,a.Wm)(P,{class:"spotnik",modelValue:e.tab,"onUpdate:modelValue":s[0]||(s[0]=s=>e.tab=s),dense:"",outline:"",align:"left","active-color":"info",breakpoint:0},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{name:"posts",label:"posts"}),(0,a.Wm)(x,{name:"follows",label:"follows"}),(0,a.Wm)(x,{name:"followers",label:"followers"}),(0,a.Wm)(x,{name:"relays",label:"relays"})])),_:1},8,["modelValue"]),(0,a.Wm)(Z,{modelValue:e.tab,"onUpdate:modelValue":s[3]||(s[3]=s=>e.tab=s),animated:"",style:{"margin-top":"10px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{name:"posts",class:"no-padding"},{default:(0,a.w5)((()=>[e.threads.length?((0,a.wg)(),(0,a.j4)(_,{key:0,class:"q-pa-sm",onSubmit:e.search},{default:(0,a.w5)((()=>[(0,a.Wm)(T,{modelValue:e.searchText,"onUpdate:modelValue":s[2]||(s[2]=s=>e.searchText=s),outlined:"",rounded:"",label:e.$t("searchPosts"),dense:"",color:"secondary",class:"no-padding",loading:e.searching,onSubmit:e.search,onKeypress:(0,l.D2)((0,l.iM)(e.search,["ctrl"]),["enter"])},{append:(0,a.w5)((()=>[(0,a.Wm)(E,{"button-text":e.searchText,"button-class":"text-secondary",onClear:s[1]||(s[1]=s=>e.searchText="")},null,8,["button-text"]),(0,a.Wm)($,{"text-color":"secondary",class:"q-pa-xs",icon:"search",type:"submit",unelevated:"",disable:e.searching,onClick:e.search},null,8,["disable","onClick"])])),_:1},8,["modelValue","label","loading","onSubmit","onKeypress"])])),_:1},8,["onSubmit"])):(0,a.kq)("",!0),e.searchResults.length?((0,a.wg)(),(0,a.iD)("div",r,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.searchResults,(s=>((0,a.wg)(),(0,a.j4)(q,{key:s[0].id,events:s,onAddEvent:e.addEvent},null,8,["events","onAddEvent"])))),128))])):(0,a.kq)("",!0),e.searchText?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",i,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.threads,(s=>((0,a.wg)(),(0,a.j4)(q,{key:s[0].id,events:s,onAddEvent:e.addEvent},null,8,["events","onAddEvent"])))),128)),(0,a.Wm)(D,{"loading-more":e.loadingMore,"reached-end":e.reachedEnd,onClick:e.loadMore},null,8,["loading-more","reached-end","onClick"])]))])),_:1}),(0,a.Wm)(j,{name:"follows",class:"no-padding"},{default:(0,a.w5)((()=>[e.follows?((0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.follows,(e=>((0,a.wg)(),(0,a.j4)(v,{key:e,pubkey:e,"show-following":!0},null,8,["pubkey"])))),128))])])):((0,a.wg)(),(0,a.iD)("div",h,(0,o.zw)(e.$t("noFollows")),1))])),_:1}),(0,a.Wm)(j,{name:"followers",class:"no-padding"},{default:(0,a.w5)((()=>[e.followers?((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",b,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(e.followers),(e=>((0,a.wg)(),(0,a.j4)(v,{key:e,pubkey:e,"show-following":!0},null,8,["pubkey"])))),128))])])):((0,a.wg)(),(0,a.iD)("div",c,(0,o.zw)(e.$t("noFollowers")),1))])),_:1}),(0,a.Wm)(j,{name:"relays",class:"no-padding"},{default:(0,a.w5)((()=>[e.relays?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("div",y,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(Object.keys(e.relays),(e=>((0,a.wg)(),(0,a.j4)(S,{key:e,url:e,"list-view":!0},null,8,["url"])))),128))])])):((0,a.wg)(),(0,a.iD)("div",m,(0,o.zw)(e.$t("NoRelays")),1))])),_:1})])),_:1},8,["modelValue"])])),_:1})}var g=t(60899),k=t(18933),v=t(14473),x=t(47399),P=t(34136),E=t(37732),$=t(68620),T=t(86842),_=t(31020);const q={title:"Dostr - Profile",meta:{description:{name:"description",content:"Nostr user profile"},keywords:{name:"keywords",content:"nostr decentralized social media"},equiv:{"http-equiv":"Content-Type",content:"text/html; charset=UTF-8"}}},D=(0,a.aZ)({name:"Profile",mixins:[k.Z,(0,_.Z)(q)],components:{BaseUserCard:x.Z,BaseRelayRecommend:E.Z,BaseButtonLoadMore:$.Z,BaseButtonClear:T.Z},data(){return{threads:[],eventsSet:new Set,sub:{},tab:"posts",followsEvent:null,follows:[],followers:[],relays:{},profilesUsed:new Set,loadingMore:!0,reachedEnd:!1,searchText:"",searching:!1,results:[],interval:null}},computed:{searchResults(){return this.searchText.length?this.results:[]},hexPubkey(){return this.$route.params.pubkey?this.bech32ToHex(this.$route.params.pubkey):""}},mounted(){this.hexPubkey.length?this.start():this.interval=setInterval((()=>{this.hexPubkey.length&&(this.start(),clearInterval(this.interval))}),500)},beforeUnmount(){this.stop()},methods:{async start(){this.loadingMore=!0;let e=Object.keys(this.$store.state.relays).length?Object.keys(this.$store.state.relays):Object.keys(this.$store.state.defaultRelays),s=await(0,P.$1)(this.hexPubkey);s&&this.$store.dispatch("handleAddingProfileEventToCache",s),this.sub.streamProfile=await(0,P.hG)({authors:[this.hexPubkey],relays:e},(async e=>{for(let s of e)this.$store.dispatch("handleAddingProfileEventToCache",s)})),this.loadMore(),this.sub.dbStreamFollows=await(0,P.so)({author:this.hexPubkey,relays:e},(e=>{for(let s of e)this.followsEvent&&s.created_at<this.followsEvent.created_at||(this.followsEvent=s,this.follows=s.tags.filter((([e,s])=>"p"===e&&s)).map((([e,s])=>s)),this.relays=s.content.length?JSON.parse(s.content):[],this.follows.length&&this.follows.forEach((e=>this.useProfile(e))))})),this.sub.dbStreamFollowers=await(0,P.AF)({author:this.hexPubkey,relays:e},(e=>{for(let s of e)this.followers[s.pubkey]=!0,this.useProfile(s.pubkey)}))},stop(){this.sub.streamProfile&&this.sub.streamProfile.cancel(),this.sub.streamUserNotes&&this.sub.streamUserNotes.cancel(),this.sub.dbStreamFollows&&this.sub.dbStreamFollows.cancel(),this.sub.dbStreamFollowers&&this.sub.dbStreamFollowers.cancel(),this.interval&&clearInterval(this.interval)},processUserNotes(e,s,t=!0){for(let a of e)this.eventsSet.has(a.id)&&t||(this.interpolateEventMentions(a),t&&this.eventsSet.add(a.id),(0,v.c)(s,a))},useProfile(e){this.profilesUsed.has(e)||(this.profilesUsed.add(e),this.$store.dispatch("useProfile",{pubkey:e}))},addEvent(e){this.processUserNotes([e],this.threads)},async loadMore(){this.loadingMore=!0;let e=Object.keys(this.$store.state.relays).length?Object.keys(this.$store.state.relays):Object.keys(this.$store.state.defaultRelays),s=this.threads.length?this.threads[this.threads.length-1][0].created_at:Math.round(Date.now()/1e3),t=await(0,P.Kk)({authors:[this.hexPubkey],until:s,limit:100,relays:e});0===t.length&&(this.reachedEnd=!0);let a=[];this.processUserNotes(t,a),this.threads=this.threads.concat(a),this.loadingMore=!1},async search(){this.searching=!0,this.results=[];let e=await(0,P.$d)(`\n        SELECT event\n        FROM nostr\n        WHERE json_extract(event,'$.kind') = 1 AND\n          json_extract(event,'$.pubkey') = '${this.hexPubkey}' AND\n          json_extract(event,'$.content') LIKE '%${this.searchText.replace(" ","%")}%'\n      `),s=e.map((e=>JSON.parse(e.event)));this.processUserNotes(s,this.results,!1),this.searching=!1},debouncedSearch(){(0,g.Z)(this.search(),1e3),console.log("debounced search")}}});var j=t(11639),S=t(69885),Z=t(47817),U=t(70900),C=t(89800),W=t(84106),B=t(8326),M=t(66611),F=t(24455),N=t(69984),R=t.n(N);const O=(0,j.Z)(D,[["render",f],["__scopeId","data-v-df5ac4d8"]]),A=O;R()(D,"components",{QPage:S.Z,QTabs:Z.Z,QTab:U.Z,QTabPanels:C.Z,QTabPanel:W.Z,QForm:B.Z,QInput:M.Z,QBtn:F.Z})}}]);